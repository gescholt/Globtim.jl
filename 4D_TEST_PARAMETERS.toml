# 4D Benchmark Test Configuration
# Exact parameters for HPC cluster execution

[metadata]
test_name = "4D_Benchmark_HPC_Test"
version = "1.0.0"
created = "2025-08-09"
description = "Comprehensive 4D benchmark testing for HPC cluster validation"

[execution]
julia_flags = ["--compiled-modules=no", "--project=."]
max_execution_time = "01:30:00"  # 1.5 hours
memory_per_cpu = "4G"
cpu_count = 4
partition = "batch"
account = "mpi"

# ============================================================================
# BENCHMARK FUNCTIONS
# ============================================================================

[functions.sphere]
name = "Sphere"
formula = "sum(x[i]^2 for i in 1:4)"
domain_min = -5.12
domain_max = 5.12
global_minimum = [0.0, 0.0, 0.0, 0.0]
f_minimum = 0.0
center_point = [0.0, 0.0, 0.0, 0.0]
sample_range = 2.0
properties = ["unimodal", "smooth", "well_conditioned"]
priority = 1  # Primary test function

[functions.rosenbrock]
name = "Rosenbrock"
formula = "sum(100*(x[i+1] - x[i]^2)^2 + (1 - x[i])^2 for i in 1:3)"
domain_min = -2.048
domain_max = 2.048
global_minimum = [1.0, 1.0, 1.0, 1.0]
f_minimum = 0.0
center_point = [0.5, 0.5, 0.5, 0.5]
sample_range = 1.5
properties = ["multimodal", "challenging", "banana_shaped"]
priority = 2  # Secondary test function

# ============================================================================
# TEST CONFIGURATIONS
# ============================================================================

[test_modes.light]
description = "Quick validation test"
polynomial_degrees = [4, 6]
functions = ["sphere"]
expected_runtime = "10-15 minutes"
resource_usage = "low"

[test_modes.medium]
description = "Standard benchmark test"
polynomial_degrees = [4, 6, 8]
functions = ["sphere", "rosenbrock"]
expected_runtime = "30-45 minutes"
resource_usage = "medium"

[test_modes.heavy]
description = "Comprehensive analysis"
polynomial_degrees = [4, 6, 8, 10]
functions = ["sphere", "rosenbrock"]
expected_runtime = "60-90 minutes"
resource_usage = "high"

# ============================================================================
# COMPUTATIONAL PARAMETERS
# ============================================================================

[computation]
tolerance = 1e-12
max_iterations = 1000
convergence_threshold = 1e-10
numerical_precision = "Float64"

[sparsification]
enabled = true
thresholds = [1e-6, 1e-8, 1e-10, 1e-12]
track_coefficient_reduction = true
analyze_approximation_quality = true

[critical_points]
solver = "solve_polynomial_system"
classification_tolerance = 1e-8
distance_tolerance = 1e-6
max_critical_points = 100

[convergence_analysis]
use_forwarddiff = true
track_l2_norm = true
track_gradient_norm = true
convergence_rate_analysis = true

# ============================================================================
# OUTPUT SPECIFICATIONS
# ============================================================================

[outputs.files]
polynomial_coeffs = "polynomial_coeffs.csv"
critical_points = "critical_points.csv"
convergence_analysis = "convergence_analysis.csv"
sparsification_data = "sparsification_data.csv"
validation_summary = "validation_summary.txt"
performance_metrics = "performance_metrics.json"
test_configuration = "test_configuration.toml"

[outputs.csv_columns.polynomial_coeffs]
columns = ["degree", "coefficient_index", "coefficient_value", "monomial_powers", "sparsification_threshold"]

[outputs.csv_columns.critical_points]
columns = ["function_name", "degree", "point_id", "x1", "x2", "x3", "x4", "function_value", "classification", "distance_to_global_min", "gradient_norm"]

[outputs.csv_columns.convergence_analysis]
columns = ["function_name", "degree", "l2_norm", "gradient_norm", "convergence_rate", "approximation_error"]

[outputs.csv_columns.sparsification_data]
columns = ["function_name", "degree", "threshold", "original_coeffs", "retained_coeffs", "reduction_ratio", "approximation_quality"]

# ============================================================================
# VALIDATION CRITERIA
# ============================================================================

[validation.accuracy]
distance_to_global_min_max = 1e-6
l2_norm_convergence_rate_min = 0.5
critical_point_classification_accuracy_min = 0.95
approximation_error_max = 1e-8

[validation.performance]
max_execution_time_per_degree = 600  # seconds
max_memory_usage_gb = 8
min_sparsification_ratio = 0.1
max_numerical_instability_count = 0

[validation.completeness]
required_output_files = [
    "polynomial_coeffs.csv",
    "critical_points.csv", 
    "convergence_analysis.csv",
    "validation_summary.txt"
]
min_critical_points_found = 1
min_polynomial_degrees_completed = 2

# ============================================================================
# ERROR HANDLING
# ============================================================================

[error_handling]
continue_on_single_failure = true
max_retry_attempts = 3
save_intermediate_results = true
detailed_error_logging = true

[error_handling.recovery_strategies]
quota_exceeded = "save_partial_results_and_continue"
memory_limit = "reduce_polynomial_degree_and_retry"
numerical_instability = "adjust_tolerance_and_retry"
timeout = "save_current_progress"

# ============================================================================
# EXPECTED COMPUTATIONAL COMPLEXITY
# ============================================================================

[complexity.sphere]
degree_4 = { samples = 330, coeffs = 70, time_estimate = "2-3 min" }
degree_6 = { samples = 1287, coeffs = 210, time_estimate = "5-8 min" }
degree_8 = { samples = 3003, coeffs = 495, time_estimate = "12-18 min" }
degree_10 = { samples = 5005, coeffs = 1001, time_estimate = "25-35 min" }

[complexity.rosenbrock]
degree_4 = { samples = 330, coeffs = 70, time_estimate = "3-4 min" }
degree_6 = { samples = 1287, coeffs = 210, time_estimate = "8-12 min" }
degree_8 = { samples = 3003, coeffs = 495, time_estimate = "18-25 min" }
degree_10 = { samples = 5005, coeffs = 1001, time_estimate = "35-50 min" }

# ============================================================================
# CLUSTER-SPECIFIC SETTINGS
# ============================================================================

[cluster]
results_base_path = "~/globtim_hpc/results/4d_benchmark_tests"
temp_directory = "/tmp/4d_benchmark_$$"
julia_depot_path = "~/.julia"
use_nfs_fileserver = true
fileserver_host = "mack"
cluster_host = "falcon"
