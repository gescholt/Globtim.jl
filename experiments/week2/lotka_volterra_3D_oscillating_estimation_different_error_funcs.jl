#

using Pkg
# Pkg.activate(joinpath(@__DIR__, "./../../globtim"))
# Pkg.status()
using Revise
using Globtim
using DynamicPolynomials, DataFrames
using ProgressLogging
using Optim
using ModelingToolkit
using OrdinaryDiffEq
using StaticArrays
using DataStructures
using LinearAlgebra
using TimerOutputs
using Makie

#

Revise.includet(joinpath(@__DIR__, "../../Examples/systems/DynamicalSystems.jl"))
using .DynamicalSystems

reset_timer!(Globtim._TO)

#

const T = Float64
time_interval = T[0.0, 100.0]
p_true = T[0.3, 0.4, 0.5]
ic = T[1., 1.0]
num_points = 100
distance = log_L2_norm
model, params, states, outputs = define_lotka_volterra_3D_model_v2()
error_func = make_error_distance(
    model, outputs, ic, p_true, time_interval, num_points,
    distance)


using DynamicPolynomials
using HomotopyContinuation, ProgressLogging
n = 3
d = (:one_d_for_all, 10)
GN = 50
sample_range = 0.25
@polyvar(x[1:n]); # Define polynomial ring 
p_center = p_true + [0.10, 0.0, 0.0]
TR = test_input(error_func,
    dim=n,
    center=p_center,
    GN=GN,
    sample_range=sample_range);

#

# Chebyshev 
# @profview
pol_cheb = Constructor(
    TR, d, basis=:chebyshev, precision=RationalPrecision, verbose=true)
real_pts_cheb, (_pol, _sys, _nsols) = solve_polynomial_system(
    x, n, d, pol_cheb.coeffs;
    basis=pol_cheb.basis, return_system=true)
df_cheb = process_crit_pts(real_pts_cheb, error_func, TR)
# df_cheb, df_min_cheb = analyze_critical_points(error_func, df_cheb, TR, tol_dist=0.05);

println("########################################")
println("Lotka-Volterra 3D model with Chebyshev basis")
println("Configuration:")
println("n = ", n)
println("d = ", d)
println("GN = ", GN)
println("sample_range = ", sample_range)
println("p_true = ", p_true)
println("p_center = ", p_center)
println("Distance function: ", distance)
println("Condition number of the polynomial system: ", pol_cheb.cond_vandermonde)
println("L2 norm (error of approximation): ", pol_cheb.nrm)
println("Polynomial system:")
println("   Number os sols: ", _nsols)
println("   Bezout bound: ", map(eq -> HomotopyContinuation.ModelKit.degree(eq), _sys), " which is ", prod(map(eq -> HomotopyContinuation.ModelKit.degree(eq), _sys)))
println("Critical points found:\n", df_cheb)
println("\n(before optimization) Best critical points:\n", df_cheb[findmin(map(p -> abs(sum((p .- p_true).^2)), zip([getproperty(df_cheb, Symbol(:x, i)) for i in 1:n]...)))[2], :])
# println("\n(after optimization)  Best critical points:\n", df_min_cheb)

println(Globtim._TO)
#=
System of length 3
 3 variables: x₁, x₂, x₃

 0.322930275552276 + 0.797046871899408*x₁ - 0.392987642149709*x₂ + 0.314077567481911*x₃ - 0.46880646172785*x₂*x₁ - 2.82446551576603*x₂*x₁^2 - 17.3079081413588*x₂*x₁^3 + 23.0281843941915*x₂*x₁^4 + 56.7202507548629*x₂*x₁^5 - 76.8484312494436*x₂*x₁^6 - 39.3877031871631*x₂*x₁^7 + 58.3695999195253*x₂*x₁^8 + 2.23212368813478*x₂*x₃ - 0.930100811541893*x₂*x₃^2 + 0.000748688033629491*x₂*x₃^3 - 0.0206711502412225*x₂*x₃^4 - 0.41080325890563*x₂*x₃^5 + 0.490807366278442*x₂*x₃^6 + 0.0285105046426516*x₂*x₃^7 - 0.10662413132988*x₂*x₃^8 - 10.5602362406805*x₂^2*x₁ + 11.7028325292428*x₂^2*x₁^2 - 23.1965908151588*x₂^2*x₁^3 - 5.95542248027179*x₂^2*x₁^4 + 76.0520103247142*x₂^2*x₁^5 - 5.81320832253195*x₂^2*x₁^6 - 41.5144714058755*x₂^2*x₁^7 - 2.6924948645918*x₂^2*x₃ + 3.17709205988861*x₂^2*x₃^2 - 0.354303231257596*x₂^2*x₃^3 + 0.00781909750266833*x₂^2*x₃^4 - 0.00558792756590067*x₂^2*x₃^5 - 0.0120410964791604*x₂^2*x₃^6 + 0.115671449387148*x₂^2*x₃^7 + 10.690076090602*x₂^3*x₁ + 12.8107084365634*x₂^3*x₁^2 - 18.3693395816215*x₂^3*x₁^3 + 28.6490406793165*x₂^3*x₁^4 + 8.96765563511499*x₂^3*x₁^5 - 32.2114232079274*x₂^3*x₁^6 - 3.46009427557891*x₂^3*x₃ - 0.671084762480551*x₂^3*x₃^2 + 1.53494515552689*x₂^3*x₃^3 - 0.364912662896009*x₂^3*x₃^4 + 0.440823838300249*x₂^3*x₃^5 - 0.267008220531878*x₂^3*x₃^6 + 26.7736538230819*x₂^4*x₁ - 12.5313702213763*x₂^4*x₁^2 - 24.2422015326551*x₂^4*x₁^3 + 9.66079439041269*x₂^4*x₁^4 - 5.3446451979169*x₂^4*x₁^5 + 2.96780140275502*x₂^4*x₃ - 3.89093799162192*x₂^4*x₃^2 - 0.326821713237396*x₂^4*x₃^3 + 0.164165824998575*x₂^4*x₃^4 - 0.246903658547954*x₂^4*x₃^5 - 11.6631531612996*x₂^5*x₁ - 29.2386875321866*x₂^5*x₁^2 + 5.22434934725257*x₂^5*x₁^3 + 8.12112036367568*x₂^5*x₁^4 + 0.982107461866246*x₂^5*x₃ + 2.58889916765708*x₂^5*x₃^2 - 1.49557166627286*x₂^5*x₃^3 + 0.403739962522824*x₂^5*x₃^4 - 15.4861940657121*x₂^6*x₁ + 2.20645040181709*x₂^6*x₁^2 + 14.2518711289473*x₂^6*x₁^3 - 0.0532349978783522*x₂^6*x₃ + 0.976177921101092*x₂^6*x₃^2 + 0.72301880161216*x₂^6*x₃^3 + 4.86378393161977*x₂^7*x₁ + 10.2255388349164*x₂^7*x₁^2 + 0.545576901933446*x₂^7*x₃ - 1.50688641675987*x₂^7*x₃^2 + 1.23110188117661*x₂^8*x₁ - 1.00658720786026*x₂^8*x₃ - 1.17240772431237*x₃*x₁ - 3.59675846487474*x₃*x₁^2 + 2.47457747190156*x₃*x₁^3 + 8.80963165232544*x₃*x₁^4 - 5.20961123528155*x₃*x₁^5 - 9.06878344386663*x₃*x₁^6 + 2.46105293250135*x₃*x₁^7 + 4.46478773164209*x₃*x₁^8 - 1.20155050028298*x₃^2*x₁ + 6.26943013941854*x₃^2*x₁^2 - 7.02770128409017*x₃^2*x₁^3 - 15.0746346413323*x₃^2*x₁^4 + 19.8892936470416*x₃^2*x₁^5 + 10.184893222332*x₃^2*x₁^6 - 12.8347226106104*x₃^2*x₁^7 + 2.91897324832785*x₃^3*x₁ - 3.80600144634534*x₃^3*x₁^2 - 6.55043410136107*x₃^3*x₁^3 + 13.635264458436*x₃^3*x₁^4 + 4.34262167140218*x₃^3*x₁^5 - 10.7498476135567*x₃^3*x₁^6 - 0.0931619897917285*x₃^4*x₁ - 2.45681519314347*x₃^4*x₁^2 + 4.73028591012031*x₃^4*x₁^3 + 2.93920284729493*x₃^4*x₁^4 - 5.14953950764487*x₃^4*x₁^5 - 1.16818871009731*x₃^5*x₁ + 0.398994102755305*x₃^5*x₁^2 + 1.61663388957857*x₃^5*x₁^3 - 1.57943964787405*x₃^5*x₁^4 - 0.187916521828745*x₃^6*x₁ + 0.237873521091736*x₃^6*x₁^2 - 0.467944344325687*x₃^6*x₁^3 - 0.0314594886011544*x₃^7*x₁ + 0.335497103938056*x₃^7*x₁^2 + 0.227781699650515*x₃^8*x₁ - 2.17703406700428*x₂*x₃*x₁ - 8.36403517512626*x₂*x₃*x₁^2 + 25.0016847582694*x₂*x₃*x₁^3 + 5.00418060310302*x₂*x₃*x₁^4 - 23.2971847747182*x₂*x₃*x₁^5 + 1.65743595056077*x₂*x₃*x₁^6 + 0.972814400875021*x₂*x₃*x₁^7 - 1.10377897048917*x₂*x₃^2*x₁ + 13.0279583286573*x₂*x₃^2*x₁^2 + 3.80496565002945*x₂*x₃^2*x₁^3 - 29.7277563451924*x₂*x₃^2*x₁^4 - 5.74593684812943*x₂*x₃^2*x₁^5 + 19.8222123539139*x₂*x₃^2*x₁^6 - 0.305371003073897*x₂*x₃^3*x₁ + 2.60918346153582*x₂*x₃^3*x₁^2 - 10.970913274676*x₂*x₃^3*x₁^3 - 3.74975464719237*x₂*x₃^3*x₁^4 + 10.5515488566131*x₂*x₃^3*x₁^5 + 1.73302966251026*x₂*x₃^4*x₁ - 3.57330051616006*x₂*x₃^4*x₁^2 - 2.43476013292583*x₂*x₃^4*x₁^3 + 5.49931659555982*x₂*x₃^4*x₁^4 + 0.131663904804454*x₂*x₃^5*x₁ - 0.219562331007625*x₂*x₃^5*x₁^2 + 1.72280802183822*x₂*x₃^5*x₁^3 - 0.170382524485501*x₂*x₃^6*x₁ - 0.194931524590084*x₂*x₃^6*x₁^2 - 0.25063824637956*x₂*x₃^7*x₁ + 0.0214288230582446*x₂^2*x₃*x₁ + 13.4346672770759*x₂^2*x₃*x₁^2 + 4.37325588121982*x₂^2*x₃*x₁^3 - 20.9006785608453*x₂^2*x₃*x₁^4 - 1.14598336242871*x₂^2*x₃*x₁^5 + 11.5415755417014*x₂^2*x₃*x₁^6 + 10.297325559464*x₂^2*x₃^2*x₁ - 7.13317215086682*x₂^2*x₃^2*x₁^2 - 6.85929826590715*x₂^2*x₃^2*x₁^3 + 0.664540305008687*x₂^2*x₃^2*x₁^4 + 3.18901704792656*x₂^2*x₃^2*x₁^5 - 3.53451327552282*x₂^2*x₃^3*x₁ + 2.49359235571409*x₂^2*x₃^3*x₁^2 + 0.78823977081495*x₂^2*x₃^3*x₁^3 - 0.811349319740624*x₂^2*x₃^3*x₁^4 - 1.46078198328238*x₂^2*x₃^4*x₁ + 0.581429843606362*x₂^2*x₃^4*x₁^2 - 0.293797813952475*x₂^2*x₃^4*x₁^3 + 0.972627908882052*x₂^2*x₃^5*x₁ - 0.494039818550416*x₂^2*x₃^5*x₁^2 - 0.230501869320906*x₂^2*x₃^6*x₁ - 5.46675385569521*x₂^3*x₃*x₁ + 12.2388878971701*x₂^3*x₃*x₁^2 - 17.801354934116*x₂^3*x₃*x₁^3 - 5.67167245123082*x₂^3*x₃*x₁^4 + 14.4525929243991*x₂^3*x₃*x₁^5 - 1.46114234490358*x₂^3*x₃^2*x₁ - 7.94283127866458*x₂^3*x₃^2*x₁^2 + 4.89911952019965*x₂^3*x₃^2*x₁^3 + 3.76442809545344*x₂^3*x₃^2*x₁^4 + 6.49404201643597*x₂^3*x₃^3*x₁ - 0.294130706702569*x₂^3*x₃^3*x₁^2 - 0.839344572617776*x₂^3*x₃^3*x₁^3 - 0.496850412691288*x₂^3*x₃^4*x₁ + 0.367984796234203*x₂^3*x₃^4*x₁^2 - 0.328955716556301*x₂^3*x₃^5*x₁ + 1.61208871533106*x₂^4*x₃*x₁ - 11.6642679159249*x₂^4*x₃*x₁^2 - 2.68010795751967*x₂^4*x₃*x₁^3 + 3.24556934217462*x₂^4*x₃*x₁^4 - 14.5322212899747*x₂^4*x₃^2*x₁ + 5.74027604526622*x₂^4*x₃^2*x₁^2 + 4.27573137500434*x₂^4*x₃^2*x₁^3 + 1.7113041622846*x₂^4*x₃^3*x₁ - 1.57413768500326*x₂^4*x₃^3*x₁^2 + 1.19909768341848*x₂^4*x₃^4*x₁ + 8.40852968908703*x₂^5*x₃*x₁ - 4.17488399832792*x₂^5*x₃*x₁^2 + 0.782728699914754*x₂^5*x₃*x₁^3 + 0.205798084510494*x₂^5*x₃^2*x₁ + 2.96018871640494*x₂^5*x₃^2*x₁^2 - 4.25967476262488*x₂^5*x₃^3*x₁ - 1.2463807590645*x₂^6*x₃*x₁ + 5.36939687578395*x₂^6*x₃*x₁^2 + 6.13700796361298*x₂^6*x₃^2*x₁ - 2.01311449687936*x₂^7*x₃*x₁ - 3.29898402158208*x₁^2 + 9.2793452794832*x₁^3 + 12.0102779729872*x₁^4 - 16.1721259124235*x₁^5 - 24.4300936541539*x₁^6 + 2.57986889667795*x₁^7 + 16.4318442156073*x₁^8 + 4.47123894935645*x₁^9 - 3.2523174346345*x₂^2 - 0.915401651211216*x₂^3 + 7.1494788979657*x₂^4 - 4.07644137065834*x₂^5 - 7.1440575111856*x₂^6 + 10.8223927955766*x₂^7 + 2.7397850632771*x₂^8 - 5.78183195188317*x₂^9 - 0.408115315299998*x₃^2 + 0.021319987456497*x₃^3 + 0.0740021360334587*x₃^4 + 0.244788048134853*x₃^5 + 0.0562760447838322*x₃^6 - 0.211788784559239*x₃^7 - 0.0550819759830021*x₃^8 + 0.0449163979331652*x₃^9
 -0.264938829541389 - 0.392987642149709*x₁ + 7.5348801332428*x₂ - 3.39730620349356*x₃ - 6.50463486926899*x₂*x₁ - 10.5602362406805*x₂*x₁^2 + 7.80188835282854*x₂*x₁^3 - 11.5982954075794*x₂*x₁^4 - 2.38216899210872*x₂*x₁^5 + 25.3506701082381*x₂*x₁^6 - 1.66091666358056*x₂*x₁^7 - 10.3786178514689*x₂*x₁^8 - 5.03587976946889*x₂*x₃ - 9.22158157899945*x₂*x₃^2 + 6.99495822220509*x₂*x₃^3 + 2.85537754824882*x₂*x₃^4 - 2.40125484310495*x₂*x₃^5 + 0.140663082838385*x₂*x₃^6 - 0.00374225539842827*x₂*x₃^7 + 0.16429429704077*x₂*x₃^8 - 2.74620495363365*x₂^2*x₁ + 16.0351141359031*x₂^2*x₁^2 + 12.8107084365634*x₂^2*x₁^3 - 13.7770046862161*x₂^2*x₁^4 + 17.1894244075899*x₂^2*x₁^5 + 4.48382781755749*x₂^2*x₁^6 - 13.8048956605403*x₂^2*x₁^7 + 15.3511893747469*x₂^2*x₃ - 9.40149116128641*x₂^2*x₃^2 - 14.6284209016471*x₂^2*x₃^3 + 7.75932405413014*x₂^2*x₃^4 + 1.49785617497762*x₂^2*x₃^5 - 0.456659569553425*x₂^2*x₃^6 - 0.0888741624642287*x₂^2*x₃^7 + 28.5979155918628*x₂^3*x₁ + 53.5473076461638*x₂^3*x₁^2 - 16.7084936285018*x₂^3*x₁^3 - 24.2422015326551*x₂^3*x₁^4 + 7.72863551233015*x₂^3*x₁^5 - 3.56309679861126*x₂^3*x₁^6 + 3.22879867543907*x₂^3*x₃ + 30.8363798977343*x₂^3*x₃^2 - 11.5013097765747*x₂^3*x₃^3 - 10.844616863661*x₂^3*x₃^4 + 3.59245791356429*x₂^3*x₃^5 - 0.811824881600438*x₂^3*x₃^6 - 20.3822068532917*x₂^4*x₁ - 29.157882903249*x₂^4*x₁^2 - 48.7311458869777*x₂^4*x₁^3 + 6.53043668406571*x₂^4*x₁^4 + 8.12112036367568*x₂^4*x₁^5 - 15.3721878769763*x₂^4*x₃ + 6.73989849495237*x₂^4*x₃^2 + 24.7533204180332*x₂^4*x₃^3 - 6.65627415158821*x₂^4*x₃^4 - 1.60224743365561*x₂^4*x₃^5 - 42.8643450671136*x₂^5*x₁ - 46.4585821971363*x₂^5*x₁^2 + 4.41290080363417*x₂^5*x₁^3 + 21.3778066934209*x₂^5*x₁^4 + 1.67863115974764*x₂^5*x₃ - 25.5550747991376*x₂^5*x₃^2 + 1.71051502805852*x₂^5*x₃^3 + 9.49273101765735*x₂^5*x₃^4 + 75.7567495690363*x₂^6*x₁ + 17.0232437606692*x₂^6*x₁^2 + 23.859590614805*x₂^6*x₁^3 - 8.9071382130376*x₂^6*x₃ - 0.0157605845394639*x₂^6*x₃^2 - 9.76125811325979*x₂^6*x₃^3 + 21.9182805062168*x₂^7*x₁ + 4.92440752470644*x₂^7*x₁^2 + 0.322591756076287*x₂^7*x₃ + 3.12091552754707*x₂^7*x₃^2 - 52.0364875669485*x₂^8*x₁ + 10.9761930296601*x₂^8*x₃ + 2.23212368813478*x₃*x₁ - 1.08851703350214*x₃*x₁^2 - 2.78801172504209*x₃*x₁^3 + 6.25042118956734*x₃*x₁^4 + 1.0008361206206*x₃*x₁^5 - 3.8828641291197*x₃*x₁^6 + 0.236776564365824*x₃*x₁^7 + 0.121601800109378*x₃*x₁^8 - 0.930100811541893*x₃^2*x₁ - 0.551889485244584*x₃^2*x₁^2 + 4.3426527762191*x₃^2*x₁^3 + 0.951241412507363*x₃^2*x₁^4 - 5.94555126903848*x₃^2*x₁^5 - 0.957656141354905*x₃^2*x₁^6 + 2.8317446219877*x₃^2*x₁^7 + 0.000748688033629491*x₃^3*x₁ - 0.152685501536949*x₃^3*x₁^2 + 0.869727820511939*x₃^3*x₁^3 - 2.742728318669*x₃^3*x₁^4 - 0.749950929438473*x₃^3*x₁^5 + 1.75859147610218*x₃^3*x₁^6 - 0.0206711502412225*x₃^4*x₁ + 0.866514831255129*x₃^4*x₁^2 - 1.19110017205335*x₃^4*x₁^3 - 0.608690033231458*x₃^4*x₁^4 + 1.09986331911196*x₃^4*x₁^5 - 0.41080325890563*x₃^5*x₁ + 0.065831952402227*x₃^5*x₁^2 - 0.0731874436692083*x₃^5*x₁^3 + 0.430702005459555*x₃^5*x₁^4 + 0.490807366278442*x₃^6*x₁ - 0.0851912622427506*x₃^6*x₁^2 - 0.0649771748633613*x₃^6*x₁^3 + 0.0285105046426516*x₃^7*x₁ - 0.12531912318978*x₃^7*x₁^2 - 0.10662413132988*x₃^8*x₁ - 5.38498972918359*x₂*x₃*x₁ + 0.0214288230582446*x₂*x₃*x₁^2 + 8.95644485138397*x₂*x₃*x₁^3 + 2.18662794060991*x₂*x₃*x₁^4 - 8.36027142433811*x₂*x₃*x₁^5 - 0.381994454142902*x₂*x₃*x₁^6 + 3.29759301191468*x₂*x₃*x₁^7 + 6.35418411977722*x₂*x₃^2*x₁ + 10.297325559464*x₂*x₃^2*x₁^2 - 4.75544810057788*x₂*x₃^2*x₁^3 - 3.42964913295358*x₂*x₃^2*x₁^4 + 0.265816122003475*x₂*x₃^2*x₁^5 + 1.06300568264219*x₂*x₃^2*x₁^6 - 0.708606462515191*x₂*x₃^3*x₁ - 3.53451327552282*x₂*x₃^3*x₁^2 + 1.66239490380939*x₂*x₃^3*x₁^3 + 0.394119885407475*x₂*x₃^3*x₁^4 - 0.324539727896249*x₂*x₃^3*x₁^5 + 0.0156381950053367*x₂*x₃^4*x₁ - 1.46078198328238*x₂*x₃^4*x₁^2 + 0.387619895737575*x₂*x₃^4*x₁^3 - 0.146898906976237*x₂*x₃^4*x₁^4 - 0.0111758551318013*x₂*x₃^5*x₁ + 0.972627908882052*x₂*x₃^5*x₁^2 - 0.329359879033611*x₂*x₃^5*x₁^3 - 0.0240821929583209*x₂*x₃^6*x₁ - 0.230501869320906*x₂*x₃^6*x₁^2 + 0.231342898774295*x₂*x₃^7*x₁ - 10.3802828267367*x₂^2*x₃*x₁ - 8.20013078354281*x₂^2*x₃*x₁^2 + 12.2388878971701*x₂^2*x₃*x₁^3 - 13.351016200587*x₂^2*x₃*x₁^4 - 3.40300347073849*x₂^2*x₃*x₁^5 + 7.22629646219957*x₂^2*x₃*x₁^6 - 2.01325428744165*x₂^2*x₃^2*x₁ - 2.19171351735538*x₂^2*x₃^2*x₁^2 - 7.94283127866458*x₂^2*x₃^2*x₁^3 + 3.67433964014974*x₂^2*x₃^2*x₁^4 + 2.25865685727207*x₂^2*x₃^2*x₁^5 + 4.60483546658067*x₂^2*x₃^3*x₁ + 9.74106302465396*x₂^2*x₃^3*x₁^2 - 0.294130706702569*x₂^2*x₃^3*x₁^3 - 0.629508429463332*x₂^2*x₃^3*x₁^4 - 1.09473798868803*x₂^2*x₃^4*x₁ - 0.745275619036932*x₂^2*x₃^4*x₁^2 + 0.367984796234203*x₂^2*x₃^4*x₁^3 + 1.32247151490075*x₂^2*x₃^5*x₁ - 0.493433574834451*x₂^2*x₃^5*x₁^2 - 0.801024661595635*x₂^2*x₃^6*x₁ + 11.8712056110201*x₂^3*x₃*x₁ + 3.22417743066212*x₂^3*x₃*x₁^2 - 15.5523572212332*x₂^3*x₃*x₁^3 - 2.68010795751967*x₂^3*x₃*x₁^4 + 2.59645547373969*x₂^3*x₃*x₁^5 - 15.5637519664877*x₂^3*x₃^2*x₁ - 29.0644425799495*x₂^3*x₃^2*x₁^2 + 7.65370139368829*x₂^3*x₃^2*x₁^3 + 4.27573137500434*x₂^3*x₃^2*x₁^4 - 1.30728685294958*x₂^3*x₃^3*x₁ + 3.42260832456921*x₂^3*x₃^3*x₁^2 - 2.09885024667102*x₂^3*x₃^3*x₁^3 + 0.656663299994302*x₂^3*x₃^4*x₁ + 2.39819536683696*x₂^3*x₃^4*x₁^2 - 0.987614634191815*x₂^3*x₃^5*x₁ + 4.91053730933123*x₂^4*x₃*x₁ + 21.0213242227176*x₂^4*x₃*x₁^2 - 6.9581399972132*x₂^4*x₃*x₁^3 + 0.978410874893443*x₂^4*x₃*x₁^4 + 12.9444958382854*x₂^4*x₃^2*x₁ + 0.514495211276235*x₂^4*x₃^2*x₁^2 + 4.9336478606749*x₂^4*x₃^2*x₁^3 - 7.47785833136431*x₂^4*x₃^3*x₁ - 10.6491869065622*x₂^4*x₃^3*x₁^2 + 2.01869981261412*x₂^4*x₃^4*x₁ - 0.319409987270113*x₂^5*x₃*x₁ - 3.73914227719351*x₂^5*x₃*x₁^2 + 10.7387937515679*x₂^5*x₃*x₁^3 + 5.85706752660655*x₂^5*x₃^2*x₁ + 18.4110238908389*x₂^5*x₃^2*x₁^2 + 4.33811280967296*x₂^5*x₃^3*x₁ + 3.81903831353412*x₂^6*x₃*x₁ - 7.04590073907777*x₂^6*x₃*x₁^2 - 10.5482049173191*x₂^6*x₃^2*x₁ - 8.05269766288206*x₂^7*x₃*x₁ - 0.234403230863925*x₁^2 - 0.941488505255343*x₁^3 - 4.3269770353397*x₁^4 + 4.6056368788383*x₁^5 + 9.45337512581049*x₁^6 - 10.9783473213491*x₁^7 - 4.92346289839539*x₁^8 + 6.48551110216947*x₁^9 - 1.63125988762338*x₂^2 - 15.1266651248197*x₂^3 - 1.98377132431692*x₂^4 + 4.50158373868088*x₂^5 + 21.2861782288774*x₂^6 + 4.90157278499578*x₂^7 - 18.0200559825653*x₂^8 + 0.257814384884186*x₂^9 + 2.75753524763628*x₃^2 + 1.02023053531751*x₃^3 - 1.01493205251055*x₃^4 - 0.438524886407136*x₃^5 + 0.090997167453474*x₃^6 + 0.157985073752871*x₃^7 + 0.0598027997218073*x₃^8 - 0.0520898652932739*x₃^9
 0.409289392695851 + 0.314077567481911*x₁ - 3.39730620349356*x₂ + 2.75066227616805*x₃ + 2.23212368813478*x₂*x₁ - 1.08851703350214*x₂*x₁^2 - 2.78801172504209*x₂*x₁^3 + 6.25042118956734*x₂*x₁^4 + 1.0008361206206*x₂*x₁^5 - 3.8828641291197*x₂*x₁^6 + 0.236776564365824*x₂*x₁^7 + 0.121601800109378*x₂*x₁^8 + 5.51507049527257*x₂*x₃ + 3.06069160595253*x₂*x₃^2 - 4.05972821004222*x₂*x₃^3 - 2.19262443203568*x₂*x₃^4 + 0.545983004720844*x₂*x₃^5 + 1.1058955162701*x₂*x₃^6 + 0.478422397774459*x₂*x₃^7 - 0.468808787639465*x₂*x₃^8 - 2.6924948645918*x₂^2*x₁ + 0.0107144115291223*x₂^2*x₁^2 + 4.47822242569198*x₂^2*x₁^3 + 1.09331397030496*x₂^2*x₁^4 - 4.18013571216905*x₂^2*x₁^5 - 0.190997227071451*x₂^2*x₁^6 + 1.64879650595734*x₂^2*x₁^7 - 9.22158157899945*x₂^2*x₃ + 10.4924373333076*x₂^2*x₃^2 + 5.71075509649764*x₂^2*x₃^3 - 6.00313710776238*x₂^2*x₃^4 + 0.421989248515156*x₂^2*x₃^5 - 0.0130978938944989*x₂^2*x₃^6 + 0.657177188163079*x₂^2*x₃^7 - 3.46009427557891*x₂^3*x₁ - 2.7333769278476*x₂^3*x₁^2 + 4.0796292990567*x₂^3*x₁^3 - 4.450338733529*x₂^3*x₁^4 - 1.13433449024616*x₂^3*x₁^5 + 2.40876548739986*x₂^3*x₁^6 - 6.26766077419094*x₂^3*x₃ - 14.6284209016471*x₂^3*x₃^2 + 10.3457654055069*x₂^3*x₃^3 + 2.49642695829603*x₂^3*x₃^4 - 0.91331913910685*x₂^3*x₃^5 - 0.207373045749867*x₂^3*x₃^6 + 2.96780140275502*x₂^4*x₁ + 0.806044357665531*x₂^4*x₁^2 - 3.8880893053083*x₂^4*x₁^3 - 0.670026989379917*x₂^4*x₁^4 + 0.649113868434923*x₂^4*x₁^5 + 15.4181899488672*x₂^4*x₃ - 8.625982332431*x₂^4*x₃^2 - 10.844616863661*x₂^4*x₃^3 + 4.49057239195537*x₂^4*x₃^4 - 1.21773732240066*x₂^4*x₃^5 + 0.982107461866246*x₂^5*x₁ + 4.20426484454352*x₂^5*x₁^2 - 1.39162799944264*x₂^5*x₁^3 + 0.195682174978689*x₂^5*x₁^4 + 2.69595939798095*x₂^5*x₃ + 14.8519922508199*x₂^5*x₃^2 - 5.32501932127057*x₂^5*x₃^3 - 1.60224743365561*x₂^5*x₃^4 - 0.0532349978783522*x₂^6*x₁ - 0.623190379532251*x₂^6*x₁^2 + 1.78979895859465*x₂^6*x₁^3 - 8.5183582663792*x₂^6*x₃ + 0.855257514029261*x₂^6*x₃^2 + 6.3284873451049*x₂^6*x₃^3 + 0.545576901933446*x₂^7*x₁ - 1.00655724843968*x₂^7*x₁^2 - 0.00450302415413255*x₂^7*x₃ - 4.1833963342542*x₂^7*x₃^2 - 1.00658720786026*x₂^8*x₁ + 0.780228881886768*x₂^8*x₃ - 0.816230630599995*x₃*x₁ - 1.20155050028298*x₃*x₁^2 + 4.1796200929457*x₃*x₁^3 - 3.51385064204509*x₃*x₁^4 - 6.02985385653294*x₃*x₁^5 + 6.62976454901385*x₃*x₁^6 + 2.90996949209486*x₃*x₁^7 - 3.2086806526526*x₃*x₁^8 + 0.0639599623694909*x₃^2*x₁ + 4.37845987249177*x₃^2*x₁^2 - 3.80600144634534*x₃^2*x₁^3 - 4.9128255760208*x₃^2*x₁^4 + 8.18115867506161*x₃^2*x₁^5 + 2.17131083570109*x₃^2*x₁^6 - 4.60707754866715*x₃^2*x₁^7 + 0.296008544133835*x₃^3*x₁ - 0.186323979583457*x₃^3*x₁^2 - 3.27575359085796*x₃^3*x₁^3 + 4.73028591012031*x₃^3*x₁^4 + 2.35136227783594*x₃^3*x₁^5 - 3.43302633842991*x₃^3*x₁^6 + 1.22394024067426*x₃^4*x₁ - 2.92047177524326*x₃^4*x₁^2 + 0.664990171258841*x₃^4*x₁^3 + 2.02079236197321*x₃^4*x₁^4 - 1.57943964787405*x₃^4*x₁^5 + 0.337656268702993*x₃^5*x₁ - 0.563749565486236*x₃^5*x₁^2 + 0.475747042183471*x₃^5*x₁^3 - 0.70191651648853*x₃^5*x₁^4 - 1.48252149191467*x₃^6*x₁ - 0.11010821010404*x₃^6*x₁^2 + 0.782826575855463*x₃^6*x₁^3 - 0.440655807864017*x₃^7*x₁ + 0.91112679860206*x₃^7*x₁^2 + 0.404247581398487*x₃^8*x₁ - 1.86020162308379*x₂*x₃*x₁ - 1.10377897048917*x₂*x₃*x₁^2 + 8.68530555243821*x₂*x₃*x₁^3 + 1.90248282501473*x₂*x₃*x₁^4 - 11.891102538077*x₂*x₃*x₁^5 - 1.91531228270981*x₂*x₃*x₁^6 + 5.6634892439754*x₂*x₃*x₁^7 + 0.00224606410088847*x₂*x₃^2*x₁ - 0.458056504610846*x₂*x₃^2*x₁^2 + 2.60918346153582*x₂*x₃^2*x₁^3 - 8.22818495600699*x₂*x₃^2*x₁^4 - 2.24985278831542*x₂*x₃^2*x₁^5 + 5.27577442830654*x₂*x₃^2*x₁^6 - 0.0826846009648899*x₂*x₃^3*x₁ + 3.46605932502052*x₂*x₃^3*x₁^2 - 4.76440068821342*x₂*x₃^3*x₁^3 - 2.43476013292583*x₂*x₃^3*x₁^4 + 4.39945327644785*x₂*x₃^3*x₁^5 - 2.05401629452815*x₂*x₃^4*x₁ + 0.329159762011135*x₂*x₃^4*x₁^2 - 0.365937218346041*x₂*x₃^4*x₁^3 + 2.15351002729778*x₂*x₃^4*x₁^4 + 2.94484419767065*x₂*x₃^5*x₁ - 0.511147573456503*x₂*x₃^5*x₁^2 - 0.389863049180168*x₂*x₃^5*x₁^3 + 0.199573532498561*x₂*x₃^6*x₁ - 0.877233862328461*x₂*x₃^6*x₁^2 - 0.85299305063904*x₂*x₃^7*x₁ + 6.35418411977722*x₂^2*x₃*x₁ + 10.297325559464*x₂^2*x₃*x₁^2 - 4.75544810057788*x₂^2*x₃*x₁^3 - 3.42964913295358*x₂^2*x₃*x₁^4 + 0.265816122003475*x₂^2*x₃*x₁^5 + 1.06300568264219*x₂^2*x₃*x₁^6 - 1.06290969377279*x₂^2*x₃^2*x₁ - 5.30176991328424*x₂^2*x₃^2*x₁^2 + 2.49359235571409*x₂^2*x₃^2*x₁^3 + 0.591179828111213*x₂^2*x₃^2*x₁^4 - 0.486809591844374*x₂^2*x₃^2*x₁^5 + 0.0312763900106733*x₂^2*x₃^3*x₁ - 2.92156396656475*x₂^2*x₃^3*x₁^2 + 0.77523979147515*x₂^2*x₃^3*x₁^3 - 0.293797813952475*x₂^2*x₃^3*x₁^4 - 0.0279396378295033*x₂^2*x₃^4*x₁ + 2.43156977220513*x₂^2*x₃^4*x₁^2 - 0.823399697584027*x₂^2*x₃^4*x₁^3 - 0.0722465788749627*x₂^2*x₃^5*x₁ - 0.691505607962719*x₂^2*x₃^5*x₁^2 + 0.809700145710033*x₂^2*x₃^6*x₁ - 1.3421695249611*x₂^3*x₃*x₁ - 1.46114234490358*x₂^3*x₃*x₁^2 - 5.29522085244305*x₂^3*x₃*x₁^3 + 2.44955976009983*x₂^3*x₃*x₁^4 + 1.50577123818138*x₂^3*x₃*x₁^5 + 4.60483546658067*x₂^3*x₃^2*x₁ + 9.74106302465396*x₂^3*x₃^2*x₁^2 - 0.294130706702569*x₂^3*x₃^2*x₁^3 - 0.629508429463332*x₂^3*x₃^2*x₁^4 - 1.45965065158404*x₂^3*x₃^3*x₁ - 0.993700825382576*x₂^3*x₃^3*x₁^2 + 0.490646394978937*x₂^3*x₃^3*x₁^3 + 2.20411919150125*x₂^3*x₃^4*x₁ - 0.822389291390753*x₂^3*x₃^4*x₁^2 - 1.60204932319127*x₂^3*x₃^5*x₁ - 7.78187598324384*x₂^4*x₃*x₁ - 14.5322212899747*x₂^4*x₃*x₁^2 + 3.82685069684414*x₂^4*x₃*x₁^3 + 2.13786568750217*x₂^4*x₃*x₁^4 - 0.980465139712187*x₂^4*x₃^2*x₁ + 2.5669562434269*x₂^4*x₃^2*x₁^2 - 1.57413768500326*x₂^4*x₃^2*x₁^3 + 0.656663299994302*x₂^4*x₃^3*x₁ + 2.39819536683696*x₂^4*x₃^3*x₁^2 - 1.23451829273977*x₂^4*x₃^4*x₁ + 5.17779833531415*x₂^5*x₃*x₁ + 0.205798084510494*x₂^5*x₃*x₁^2 + 1.97345914426996*x₂^5*x₃*x₁^3 - 4.48671499881859*x₂^5*x₃^2*x₁ - 6.38951214393732*x₂^5*x₃^2*x₁^2 + 1.6149598500913*x₂^5*x₃^3*x₁ + 1.95235584220218*x₂^6*x₃*x₁ + 6.13700796361298*x₂^6*x₃*x₁^2 + 2.16905640483648*x₂^6*x₃^2*x₁ - 3.01377283351974*x₂^7*x₃*x₁ - 0.586203862156183*x₁^2 - 1.19891948829158*x₁^3 + 0.618644367975389*x₁^4 + 1.76192633046509*x₁^5 - 0.868268539213592*x₁^6 - 1.29554049198095*x₁^7 + 0.307631616562669*x₁^8 + 0.49608752573801*x₁^9 - 2.51793988473445*x₂^2 + 5.11706312491563*x₂^3 + 0.807199668859766*x₂^4 - 3.07443757539527*x₂^5 + 0.27977185995794*x₂^6 - 1.27244831614823*x₂^7 + 0.0403239695095359*x₂^8 + 1.21957700329556*x₂^9 - 3.71249237028961*x₃^2 - 0.281781379344626*x₃^3 + 0.931011964775793*x₃^4 + 1.1187930751523*x₃^5 + 0.105749614150324*x₃^6 - 0.668508837512819*x₃^7 - 0.277566242227564*x₃^8 + 0.124605786343391*x₃^9

=#

#=
########################################
Lotka-Volterra 3D model with Chebyshev basis
Configuration:
n = 3
d = (:one_d_for_all, 10)
GN = 80
sample_range = 0.25
p_true = [0.3, 0.4, 0.5]
p_center = [0.4, 0.4, 0.5]
Distance function: log_L2_norm
Condition number of the polynomial system: 8.00000000000003
L2 norm (error of approximation): 0.4546990183817368
Critical points found:
16×4 DataFrame
 Row │ x1        x2        x3        z        
     │ Float64   Float64   Float64   Float64  
─────┼────────────────────────────────────────
   1 │ 0.633657  0.630315  0.745223  1.19421
   2 │ 0.349467  0.175406  0.738281  2.73105
   3 │ 0.257395  0.193611  0.730068  2.63101
   4 │ 0.563528  0.155632  0.649693  2.82925
   5 │ 0.378707  0.223212  0.658888  2.59357
   6 │ 0.164263  0.472114  0.706341  2.2225
   7 │ 0.555774  0.572081  0.671474  1.17821
   8 │ 0.646844  0.169056  0.441531  2.95226
   9 │ 0.349601  0.386585  0.479575  0.742276
  10 │ 0.491766  0.473948  0.564318  1.14491
  11 │ 0.286885  0.295748  0.35098   1.29564
  12 │ 0.647708  0.178114  0.446614  2.944
  13 │ 0.356931  0.227576  0.633897  2.54734
  14 │ 0.621135  0.153092  0.573108  2.86962
  15 │ 0.610726  0.155889  0.720853  2.85967
  16 │ 0.578673  0.598402  0.703337  1.21782

(before optimization) Best critical points:
DataFrameRow
 Row │ x1        x2        x3        z        
     │ Float64   Float64   Float64   Float64  
─────┼────────────────────────────────────────
   9 │ 0.349601  0.386585  0.479575  0.742276
─────────────────────────────────────────────────────────────────────────────────────────
                                                Time                    Allocations      
                                       ───────────────────────   ────────────────────────
           Tot / % measured:                 194s /  99.6%           60.0GiB /  99.9%    

Section                        ncalls     time    %tot     avg     alloc    %tot      avg
─────────────────────────────────────────────────────────────────────────────────────────
Constructor                         1     182s   94.0%    182s   59.1GiB   98.6%  59.1GiB
  MainGenerate                      1     182s   93.9%    182s   59.1GiB   98.6%  59.1GiB
    evaluation                      1     171s   88.7%    171s   57.6GiB   96.1%  57.6GiB
    lambda_vandermonde              1    8.60s    4.4%   8.60s   1.14GiB    1.9%  1.14GiB
    generate_grid                   1    812ms    0.4%   812ms    272MiB    0.4%   272MiB
    linear_solve_vandermonde        1    174ms    0.1%   174ms    651KiB    0.0%   651KiB
    norm_computation                1    128ms    0.1%   128ms   36.6MiB    0.1%  36.6MiB
solve_polynomial_system             1    11.6s    6.0%   11.6s    879MiB    1.4%   879MiB
test_input                          1    670ns    0.0%   670ns      240B    0.0%     240B
─────────────────────────────────────────────────────────────────────────────────────────


########################################
Lotka-Volterra 3D model with Chebyshev basis
Configuration:
n = 3
d = (:one_d_for_all, 10)
GN = 80
sample_range = 0.25
p_true = [0.3, 0.4, 0.5]
p_center = [0.4, 0.4, 0.5]
Distance function: L1_norm
Condition number of the polynomial system: 8.00000000000003
L2 norm (error of approximation): 881.5328492215016
Critical points found:
9×4 DataFrame
 Row │ x1        x2        x3        z       
     │ Float64   Float64   Float64   Float64 
─────┼───────────────────────────────────────
   1 │ 0.64609   0.164181  0.517536  7078.21
   2 │ 0.256052  0.535928  0.740075  1894.49
   3 │ 0.648559  0.179959  0.619042  6704.01
   4 │ 0.57749   0.17484   0.634749  6687.44
   5 │ 0.592827  0.163957  0.61723   6714.53
   6 │ 0.489553  0.464691  0.551692  1938.88
   7 │ 0.316707  0.323519  0.374627  2146.11
   8 │ 0.159228  0.459135  0.621788  4013.16
   9 │ 0.358093  0.392314  0.471773  1750.75

(before optimization) Best critical points:
DataFrameRow
 Row │ x1        x2        x3        z       
     │ Float64   Float64   Float64   Float64 
─────┼───────────────────────────────────────
   9 │ 0.358093  0.392314  0.471773  1750.75
─────────────────────────────────────────────────────────────────────────────────────────
                                                Time                    Allocations      
                                       ───────────────────────   ────────────────────────
           Tot / % measured:                 177s /  99.7%           59.9GiB / 100.0%    

Section                        ncalls     time    %tot     avg     alloc    %tot      avg
─────────────────────────────────────────────────────────────────────────────────────────
Constructor                         1     168s   95.4%    168s   59.1GiB   98.6%  59.1GiB
  MainGenerate                      1     168s   95.4%    168s   59.1GiB   98.6%  59.1GiB
    evaluation                      1     159s   90.3%    159s   57.6GiB   96.1%  57.6GiB
    lambda_vandermonde              1    7.69s    4.4%   7.69s   1.14GiB    1.9%  1.14GiB
    generate_grid                   1    796ms    0.5%   796ms    272MiB    0.4%   272MiB
    norm_computation                1    131ms    0.1%   131ms   36.6MiB    0.1%  36.6MiB
    linear_solve_vandermonde        1   76.0ms    0.0%  76.0ms    650KiB    0.0%   650KiB
solve_polynomial_system             1    8.09s    4.6%   8.09s    874MiB    1.4%   874MiB
test_input                          1   1.51μs    0.0%  1.51μs      240B    0.0%     240B
─────────────────────────────────────────────────────────────────────────────────────────

########################################
Lotka-Volterra 3D model with Chebyshev basis
Configuration:
n = 3
d = (:one_d_for_all, 10)
GN = 80
sample_range = 0.25
p_true = [0.3, 0.4, 0.5]
p_center = [0.4, 0.4, 0.5]
Distance function: L2_norm
Condition number of the polynomial system: 8.00000000000003
L2 norm (error of approximation): 1.0221468007040861
Critical points found:
10×4 DataFrame
 Row │ x1        x2        x3        z       
     │ Float64   Float64   Float64   Float64 
─────┼───────────────────────────────────────
   1 │ 0.560589  0.185134  0.662531  7.02393
   2 │ 0.554298  0.165332  0.641438  7.09748
   3 │ 0.590851  0.18505   0.646644  7.05119
   4 │ 0.593027  0.163203  0.57099   7.34592
   5 │ 0.421963  0.168638  0.745486  6.83997
   6 │ 0.482345  0.466186  0.540961  2.27329
   7 │ 0.324599  0.338665  0.388596  1.97344
   8 │ 0.161315  0.446856  0.633746  4.57547
   9 │ 0.353707  0.381628  0.450837  1.7488
  10 │ 0.269336  0.507291  0.671735  2.37156

(before optimization) Best critical points:
DataFrameRow
 Row │ x1        x2        x3        z       
     │ Float64   Float64   Float64   Float64 
─────┼───────────────────────────────────────
   9 │ 0.353707  0.381628  0.450837   1.7488
─────────────────────────────────────────────────────────────────────────────────────────
                                                Time                    Allocations      
                                       ───────────────────────   ────────────────────────
           Tot / % measured:                 185s /  99.7%           59.9GiB / 100.0%    

Section                        ncalls     time    %tot     avg     alloc    %tot      avg
─────────────────────────────────────────────────────────────────────────────────────────
Constructor                         1     178s   96.2%    178s   59.1GiB   98.6%  59.1GiB
  MainGenerate                      1     178s   96.2%    178s   59.1GiB   98.6%  59.1GiB
    evaluation                      1     169s   91.2%    169s   57.6GiB   96.1%  57.6GiB
    lambda_vandermonde              1    7.92s    4.3%   7.92s   1.14GiB    1.9%  1.14GiB
    generate_grid                   1    791ms    0.4%   791ms    272MiB    0.4%   272MiB
    norm_computation                1    120ms    0.1%   120ms   36.6MiB    0.1%  36.6MiB
    linear_solve_vandermonde        1   57.3ms    0.0%  57.3ms    650KiB    0.0%   650KiB
solve_polynomial_system             1    6.96s    3.8%   6.96s    875MiB    1.4%   875MiB
test_input                          1   1.70μs    0.0%  1.70μs      240B    0.0%     240B
─────────────────────────────────────────────────────────────────────────────────────────

=#
