#!/bin/bash
# Pre-commit hook to ensure GPG signing is enabled

# Check if GPG signing is enabled
if [ "$(git config commit.gpgsign)" != "true" ]; then
    echo "⚠️  Warning: GPG signing is not enabled!"
    echo "Enable it with: git config commit.gpgsign true"
    echo "Continuing anyway..."
fi

# Verify signing key is configured
SIGNING_KEY=$(git config user.signingkey)
if [ -z "$SIGNING_KEY" ]; then
    echo "❌ Error: No GPG signing key configured!"
    echo "Configure it with: git config user.signingkey YOUR_KEY_ID"
    exit 1
fi

# Verify the key exists
if ! gpg --list-secret-keys "$SIGNING_KEY" >/dev/null 2>&1; then
    echo "❌ Error: GPG key $SIGNING_KEY not found!"
    echo "Available keys:"
    gpg --list-secret-keys --keyid-format=long
    exit 1
fi

# All good
exit 0